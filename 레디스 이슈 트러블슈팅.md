
## 문제 인지
현재 프로젝트에 다음과 같은 문제가 있다.
- 우리 프로젝트에서는 레디스를 사용하여 commentCount, likeCount를 관리하고 있다.
- 이를 기준으로 한 sort(랭킹)을 위해서 사용한다.
- 하지만 정상적으로 redis가 업데이트 되고 있지 않는 것으로 확인되었다.

## 상황 파악
우리 프로젝트에서 레디스가 어떻게 사용되고 있는지 먼저 파악하였다.
- 기본적으로 직렬화할 때 TIMESTAMPS 형식을 disable 함
- 직렬화할 때 자바의 LocalDateTime으로 적용시킴
- 타입 검사할 때 non-final이 기본값으로 되도록 설정
- Lettuce(레디스 자바 클라이언트) 사용
- 적용 자료구조 : String
	- key-value 형태로 저장중 (우리는 <String, Object>로 저장)
		- string의 prefix 가 "postCount : {postId}"로 구성됨
		- value는 PostCountInfo {Long commentCount, Long likeCount} 로 구성됨
		- ttl은 86400L로 설정 (second 단위, 1 day ; 즉, 업데이트 주기는 하루)
			`public static final Long POST_COUNT_INFO_EXPIRE_SEC = 86400L;`
	- `get`, `set` 명령어 사용 with `opsForX()`
	- hash table로 이용
	
## 문제 원인 확인

like를 생성하거나 지울 때, 그리고 comment가 생성되거나 지워질 때 redis에 processor를 통해 업데이트를 해줘야 하는데, 이게 로직에 반영되어 있지 않아서 발생하는 문제였다. 즉, 현재는 레디스 데이터 업데이트를 `expiredate`에 의존하고 있는 것이다. (말이 안되는 상황)

~~이래서 자고 일어났더니 제대로 되는 것 같다는 프론트엔드 협업자의 코멘트가 있었나보다. 1분 뒤에 자기가 잘못봤다고 말하더이다.~~

현재 레디스 사용 로직이 매우 단순하게 구성되어 있어서 파악이 어렵지 않았다. 바로 한번 고쳐보자

## 문제 해결

DB에 count 쿼리 날려서 업데이트 하는건 비용이 크니까,
사실 DB 수정 api가 동작할 때 마다 해당 데이터값을 `+1`, `-1`만 해주면 되는 것이므로 redis에서 해당 데이터를 가져온 뒤에 `+1` , `-1` 을 해주면 될 듯 하다.

TODO LIST
1. commentlike api
2. comment create(parent, child) / delete

### AS-IS

### TO-BE
1. commentlikecommand