
## 쿠키가 뭐에요?

쿠키는 stateless한 HTTP의 통신 방식에서 각 유저의 정보를 관리하여 편안한 유저 경험을 주기 위해 고안된 기술입니다. 이는 유저 정보를 담고 있는 작은 텍스트 파일로, 클라이언트 브라우저에 저장됩니다. 웹 서버는 응답 헤더에 'Set-Cookie'를 포함하여 클라이언트에 쿠키를 설정할 수 있습니다. 이후 클라이언트는 모든 요청에 이 쿠키를 포함하여 서버에 전송합니다. 쿠키는 사용자의 로그인 정보(상태) 등을 저장해두고 이를 보내주며 stateless를 극복하는 것에 주로 사용됩니다.

쿠키는 HTTP 요청(request) 또는 응답(response)의 헤더 부분에 포함됩니다. 즉, 응용 계층(Application layer)에서 사용되는 데이터입니다.

서버가 클라이언트에게 쿠키를 설정하려면, 서버는 HTTP 응답의 'Set-Cookie' 헤더를 사용하여 쿠키를 전달합니다. 이 헤더는 쿠키의 이름, 값, 만료 날짜, 도메인, 경로 등의 속성을 포함할 수 있습니다.

클라이언트가 서버에게 요청을 보낼 때, 클라이언트는 'Cookie' 헤더를 사용하여 이전에 설정된 쿠키를 서버에 전달합니다. 이 헤더는 쿠키의 이름과 값이 쌍을 이루는 목록을 포함합니다. 주의할 것은, 쿠키는 용량이 제한되어 있습니다. 대부분의 브라우저에서는 쿠키의 최대 크기를 4KB로 제한하고 있으므로, 정보를 쿠키에 담는 것에 한계가 있으며, 너무 많이 담으면 당연히 네트워크 통신 오버헤드가 발생합니다. 따라서 필요한 최소한의 정보만 쿠키에 담아두고 활용하는 경우가 많습니다.

따라서, 쿠키는 HTTP 요청과 응답의 헤더를 통해 클라이언트와 서버 간에 전달되며, 이를 통해 상태 정보를 유지하게 됩니다. 생명 주기로는, **쿠키는 만료 날짜가 지나거나 사용자가 직접 삭제하기 전까지 유지됩니다.**

## 쿠키는 어디에 저장되는거에요?

**쿠키**는 논리적으로는 웹 브라우저의 저장소에 저장됩니다. 이 위치는 사용하는 브라우저와 운영 체제에 따라 다릅니다. 예를 들어, 크롬 브라우저를 사용하는 경우 Windows에서는 'C:\사용자\AppData\Local\Google\Chrome\User Data\Default\Cookies' 경로에, MacOS에서는 '~/Library/Application Support/Google/Chrome/Default/Cookies' 경로에 쿠키가 저장됩니다.

## 쿠키는 어떻게 오고 가나요?

HTTP 프로토콜에 따른 특정한 형식으로 request와 response가 서버와 클라이언트 간에 오고 가는데, 여기에는 헤더와 바디가 포함되며, 쿠키는 헤더 부분에 포함됩니다.

예를 들어, 쿠키가 포함된 HTTP 요청은 다음과 같이 보일 수 있습니다.

```javascript
GET /index.html HTTP/1.1
Host: www.example.com
Cookie: my_cookie=my_value
```

이 요청에서 'Cookie' 헤더는 클라이언트가 이전에 저장한 쿠키를 서버에 전달합니다.

반면, 서버가 브라우저에 쿠키를 설정하도록 하는 HTTP 응답은 다음과 같이 보일 수 있습니다.

```javascript
HTTP/1.1 200 OK
Content-type: text/html
Set-Cookie: your_cookie=your_value; Expires=Wed, 21 Oct 2025 07:28:00 GMT; Secure; HttpOnly

<html>
...
</html>
```

이 응답에서 'Set-Cookie' 헤더는 서버가 클라이언트에 쿠키를 설정하도록 지시합니다. 이 헤더에는 쿠키의 이름, 값, 만료 날짜, 그리고 다른 옵션들이 포함될 수 있습니다. 이 예시에서는 'Secure' 옵션과 'HttpOnly' 옵션을 사용하여, 쿠키가 HTTPS 연결에서만 전송되고, 자바스크립트를 통한 접근이 차단되도록 설정하였습니다.

## 개발은?

Java의 Spring Boot를 사용하여 쿠키를 설정하는 간단한 컨트롤러 코드는 다음과 같습니다

```java
@RestController
public class CookieController {

    @GetMapping("/setCookie")
    public ResponseEntity<String> setCookie(HttpServletResponse response) {
        Cookie cookie = new Cookie("your_cookie", "your_value");
        cookie.setMaxAge(60 * 60 * 24 * 365); // 1 year
        cookie.setSecure(true);
        cookie.setHttpOnly(true);
        response.addCookie(cookie);
        
        return ResponseEntity.ok().header(HttpHeaders.SET_COOKIE, response.getHeader(HttpHeaders.SET_COOKIE)).body("Cookie has been set");
    }
}
```

이 코드는 '/setCookie' 경로에 GET 요청이 오면 'your_cookie'라는 이름의 쿠키를 설정합니다.

이제 클라이언트 측에서 쿠키를 수신하여 저장하고, 요청에 담아 보내는 JavaScript 코드는 다음과 같습니다:

```javascript
// 쿠키를 수신하고 저장하는 것은 브라우저가 자동으로 수행합니다.
// 따라서, JavaScript로 별도의 처리를 하지 않아도 됩니다.

// 쿠키를 요청에 담아 보내는 코드:
const xhr = new XMLHttpRequest();
xhr.open('GET', 'http://www.example.com/index.html');
xhr.withCredentials = true; // 이 옵션을 사용하여 쿠키를 요청에 포함시킵니다.
xhr.send();
```

이 JavaScript 코드는 XMLHttpRequest 객체를 사용하여 서버에 GET 요청을 보냅니다. 'withCredentials' 속성을 'true'로 설정하여, 이 요청에 브라우저에 저장된 쿠키를 포함시킵니다.
