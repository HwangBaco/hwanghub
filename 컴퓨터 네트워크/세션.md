## 세션이 뭐에요?

세션은 서버 측에서 관리되는 사용자 정보입니다. 사용자마다 고유한 세션 ID를 부여하고, 이 ID를 통해 사용자의 정보를 서버에 저장하거나 조회합니다. 세션 ID는 일반적으로 쿠키를 통해 클라이언트에 저장되며, 클라이언트는 요청 시 이 세션 ID를 서버에 전송합니다.

생명 주기로는, **세션은 클라이언트가 브라우저를 닫을 때 종료되거나, 서버에서 명시적으로 세션을 삭제할 때 종료됩니다.**

주의할 점은, 유저가 많아질수록 이를 관리하기 위해 서버의 메모리를 많이 잡아먹는다는 겁니다. 또한 엔터프라이즈 레벨에서 많이 사용되는 MSA 구조에서는 분산 컴퓨팅 환경이기 때문에 세션 정보를 동기화하는 작업이 복잡합니다. 로드 밸런싱만 추가되어도 세션 관리가 어렵기 때문에 최근에는 쿠키만을 이용한 방식이 우선적으로 고려되고 있습니다. (인증 관련 처리는 JWT와 같은 토큰을 이용하여 stateless하게 처리가 가능합니다.)

세션은 서버 메모리에 저장될 수도, DB에 저장될 수도 있고, redis와 같은 특수 DB에 저장될 수도 있습니다.

## 구현

서버

```java
// Session이 있으면 가져오고 없으면 null return
HttpSession session = httpServletRequest.getSession(false);
// Session이 있으면 가져오고 없으면 Session을 생성해서 return (default = true)
HttpSession session = httpServeltRequest.getSession(true);

session.setAttribute("userId", user.getId());
// Session의 유효 시간 설정 (1800초 = 30분)
session.setMaxInactiveInterval(1800);

// 로그인 유저 얻기
Long loginUserId = (Long) session.getAttribute("userId");
```


클라이언트 측에서는 세션 ID를 직접 다루지 않고, 브라우저가 자동으로 세션 ID를 쿠키에 저장하고 요청에 포함합니다. 따라서, 클라이언트 측 코드에서는 서버에 요청을 보내기만 하면 됩니다:

```javascript
// Fetch API를 사용하여 서버에 요청을 보내는 예시:

// 세션 설정 요청
fetch('http://localhost:8080/setSession', {credentials: 'same-origin'})
    .then(response => response.text())
    .then(text => console.log(text));

// 세션 조회 요청
fetch('http://localhost:8080/getSession', {credentials: 'same-origin'})
    .then(response => response.text())
    .then(text => console.log(text));
```

이 JavaScript 코드는 Fetch API를 사용하여 서버에 GET 요청을 보냅니다. 'credentials' 옵션을 'same-origin'으로 설정하여, 이 요청에 쿠키를 포함시킵니다. 이 쿠키는 브라우저가 자동으로 관리하는 세션 ID를 포함하고 있습니다.